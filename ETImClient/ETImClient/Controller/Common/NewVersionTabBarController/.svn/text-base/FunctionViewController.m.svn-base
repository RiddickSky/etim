//
//  FunctionViewController.m
//  HM-HEALTH
//
//  Created by hujiwei on 14/7/17.
//  Copyright (c) 2014年 PingAn. All rights reserved.
//

#import "FunctionViewController.h"
#import "EditFunctionVierController.h"
#import "YLInsuranceService.h"
#import "PayAutoViewController.h"
#import "JKQuickAskDoctorIndexViewController.h"
#import "JKSimicalMainViewController.h"
#import "JKPedViewController.h"
#import "JKChooseAreaViewController.h"
#import "JKOrderDoctorViewController.h"
#import "JKHomeActivityViewController.h"
#import "JKOrderDoctorViewController.h"
#import "JKHCProductViewController.h"
#import "JKHealthCKPreeViewController.h"
#import "IndividualInfoViewController.h"
#import "JKBusinessInputView.h"

#import "YLInferiorGoodsListViewController.h"

static NSString* titles[] = {@"保险服务",@"医疗服务",@"体检服务",@"健康管理",@"活动中心"};

@interface FunctionViewController ()
{
    NSMutableArray*    _imageNames;
    NSMutableArray*    _titles;
    float cellHeight;
}
@end

@implementation FunctionViewController

- (void)dealloc
{
    [[NSNotificationCenter defaultCenter] removeObserver:self];
    CARELEASE(_imageNames);
    CARELEASE(_titles);
    CARELEASE(_tableView);
    [super dealloc];
}

- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil
{
    self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];
    if (self) {
        // Custom initialization
    }
    return self;
}

- (void)viewDidLoad
{
    [super viewDidLoad];
    // Do any additional setup after loading the view.
    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(paySuccessNotif:) name:@"kJKHCKuaiQIanPaySuccess" object:nil];
    self.title = @"更多服务";
    cellHeight = 180;
//    self.navigationItem.rightBarButtonItem = [[UIBarButtonItem alloc] initWithImage:[UIImage imageNamed:@"ylImage_Edit.png"] style:UIBarButtonItemStyleBordered target:self action:@selector(editFun)];
//    [self.navigationItem.rightBarButtonItem setTintColor:[UIColor whiteColor]];
    
    _imageNames = [[NSMutableArray alloc] initWithObjects:@"ylorder_query_nor@2x.png",@"grzfxx@2x.png",@"njzhxx@2x.png",@"ylpay_query_nor@2x.png",@"grjfxx@2x.png",@"zizhulipei@2x.png",@"wentijian@2x.png", nil];
    _titles = [[NSMutableArray alloc] initWithObjects:@"个人保单查询",@"投保保单查询",@"长险账户查询",@"理赔状态查询",@"理赔信息查询",@"自助理赔",@"问题件处理", nil];

    _tableView = [[UITableView alloc] initWithFrame:CGRectMake(0, 0, SizeWidth(self.view), SizeHeight(self.view) - (IOS7 ? 64 : 44))];
    _tableView.separatorStyle = UITableViewCellSelectionStyleBlue;
    _tableView.delegate = self;
    _tableView.dataSource = self;
    _tableView.backgroundColor = [UIColor colorWithHexString:@"e8f4f7"];
    [self.view addSubview:_tableView];
    

}

- (void)editFun
{
    EditFunctionVierController* editVC = [[[EditFunctionVierController alloc] init] autorelease];
    [self.navigationController pushViewController:editVC animated:YES];
}


#pragma mark - Table view data source

- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView
{
    return 1;
}

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section
{
    return 5;
}

- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath
{
    if (0 == indexPath.row) {
        return cellHeight;
    }
    return 110;
}

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    if (0 == indexPath.row) {
        static NSString *CellIdentifier = @"MultCell";

        YLMultFunctionCell *cell = (YLMultFunctionCell*)[tableView dequeueReusableCellWithIdentifier:CellIdentifier];
        if (nil == cell) {
            cell = [[[YLMultFunctionCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier] autorelease];
            cell.selectionStyle = UITableViewCellSelectionStyleNone;
            cell.delegate = self;
            cell.accessoryView = [[[UIImageView alloc] initWithImage:IMAGE(@"ylfun_right_arrow@2x.png")]autorelease];
            cell.backgroundColor = [UIColor colorWithHexString:@"e8f4f7"];
        }
        if (0 == indexPath.row) {
            cell.button.hidden = NO;
            if (180 == cellHeight) {
                [cell.button setBackgroundImage:IMAGE(@"fun_shouqi@2x.png")
                                       forState:UIControlStateNormal];
            }else{
                [cell.button setBackgroundImage:IMAGE(@"fun_kuozhan@2x.png")
                                       forState:UIControlStateNormal];
            }
        }

        cell.title.text = titles[indexPath.row];
        cell.tag = indexPath.row;
        if (cellHeight == 180) {
            [cell showYearMoneyWithImageNames:_imageNames titles:_titles count:_imageNames.count withHeight:cellHeight];
        }else{
            [cell showYearMoneyWithImageNames:_imageNames titles:_titles count:4 withHeight:cellHeight];
        }
        return cell;

    }
    
    NSString *CellIdentifier = [NSString stringWithFormat:@"Cell_%02d",indexPath.row];

    YLFunctionCell *cell = [tableView dequeueReusableCellWithIdentifier:CellIdentifier];
    if (nil == cell) {
        cell = [[[YLFunctionCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier] autorelease];
        cell.selectionStyle = UITableViewCellSelectionStyleNone;
        cell.delegate = self;
        cell.button.hidden = YES;
        cell.backgroundColor = [UIColor colorWithHexString:@"e8f4f7"];

        switch (indexPath.row) {
            case 0://保险服务

                [cell showHome];
                break;
            case 1:///医疗服务
                [cell doctorService];
                break;
            case 2:///体检服务
                [cell healthCheck];
                break;
            case 3:///健康管理
                [cell healthMagnage];
                break;
            case 4:///活动中心
                [cell activityCenter];
                break;
            default:
                break;
        }
    }
    cell.title.text = titles[indexPath.row];
    cell.tag = indexPath.row;
    return cell;
}

#pragma mark - Table view delegate

- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath
{
    if (indexPath.row == 0) {
        [tableView deselectRowAtIndexPath:indexPath animated:YES];
        [self serviceBtnClick];
    }

}

- (void)serviceBtnClick
{
    YLInsuranceService *serviceVC = [[[YLInsuranceService alloc] initWithNibName:@"YLInsuranceService" bundle:nil] autorelease];
    
    serviceVC.hidesBottomBarWhenPushed = YES;
    
    [self.navigationController pushViewController:serviceVC animated:YES];
}

#pragma mark - YLFunctionCellDelegate
- (void)tableViewCellAtTag:(int)tag  buttonIndex:(int)index
{
    switch (tag) {
        case 0:///保险服务
            switch (index) {
                case 0:///保单查询
                {
                    YLMainWebViewController *ylWebVC = [[[YLMainWebViewController alloc] init] autorelease];
                    ylWebVC.hidesBottomBarWhenPushed = YES;
                    [ylWebVC startLoadWebViewWithUrlString:[NSString stringWithFormat:@"%@/m/insurance/index.html", CSSP_HOST_URL]];
                    ylWebVC.javascriptString = @"javascript:forward('#service/guaranteeSlip/guaranteeSlip/initIndex')";
                    
                    [self.navigationController pushViewController:ylWebVC animated:YES];
                }
                    break;
                case 1:///投保保单查询
                {
                    YLMainWebViewController *ylWebVC = [[[YLMainWebViewController alloc] init] autorelease];
                    ylWebVC.hidesBottomBarWhenPushed = YES;
                    [ylWebVC startLoadWebViewWithUrlString:[NSString stringWithFormat:@"%@/m/insurance/index.html", CSSP_HOST_URL]];
                    ylWebVC.javascriptString = @"javascript:forward('#service/guaranteeQuery/guaranteeQuery/initIndex')";
                    [self.navigationController pushViewController:ylWebVC animated:YES];
                }
                    break;
                    
                case 2:///长险账户查询
                {
                    YLMainWebViewController *ylWebVC = [[[YLMainWebViewController alloc] init] autorelease];
                    ylWebVC.hidesBottomBarWhenPushed = YES;
                    [ylWebVC startLoadWebViewWithUrlString:[NSString stringWithFormat:@"%@/m/insurance/index.html", CSSP_HOST_URL]];
                    ylWebVC.javascriptString = @"javascript:forward('#service/longInsurAccQuery/infoQuery/index')";
                    [self.navigationController pushViewController:ylWebVC animated:YES];
                }
                    break;
                case 3:///理赔状态查询
                {
                    YLMainWebViewController *ylWebVC = [[[YLMainWebViewController alloc] init] autorelease];
                    ylWebVC.hidesBottomBarWhenPushed = YES;
                    [ylWebVC startLoadWebViewWithUrlString:[NSString stringWithFormat:@"%@/m/insurance/index.html", CSSP_HOST_URL]];
                    ylWebVC.javascriptString = @"javascript:forward('#service/claimApplyStsQuery/claimApplyStsQuery/initIndex')";
                    [self.navigationController pushViewController:ylWebVC animated:YES];
                }
                    break;
                case 4:///理赔信息查询
                {
                    YLMainWebViewController *ylWebVC = [[[YLMainWebViewController alloc] init] autorelease];
                    ylWebVC.hidesBottomBarWhenPushed = YES;
                    [ylWebVC startLoadWebViewWithUrlString:[NSString stringWithFormat:@"%@/m/insurance/index.html", CSSP_HOST_URL]];
                    ylWebVC.javascriptString = @"javascript:forward('#service/claimPolQuery/claimPolQuery/initIndex')";
                    [self.navigationController pushViewController:ylWebVC animated:YES];
                }
                    break;
                case 5:///自助理赔
                {
                    PayAutoViewController *payAutoVC = [[[PayAutoViewController alloc] init] autorelease];
                    payAutoVC.hidesBottomBarWhenPushed = YES;
                    [self.navigationController pushViewController:payAutoVC animated:YES];
                }
                    break;
                case 6:///问题件处理
                {
                    YLInferiorGoodsListViewController* inferiorCon = [[[YLInferiorGoodsListViewController alloc] init] autorelease];
                    inferiorCon.hidesBottomBarWhenPushed = YES;
                    [self.navigationController pushViewController:inferiorCon animated:YES];
                }
                    break;
                default:
                    break;
            }
            break;
        case 1:///医疗服务
            switch (index) {
                    
                case 0:///预约挂号
                {
                    if(![[JKUserUtil currentUser] profileFull]){
                        IndividualInfoViewController *ivc = [[[IndividualInfoViewController alloc] init] autorelease];
                        ivc.hidesBottomBarWhenPushed = YES;
                        ivc.viewController = @"JKChooseAreaViewController";
                        [self.navigationController pushViewController:ivc animated:YES];
                        return;
                    }
                    if ([[NSUserDefaults standardUserDefaults] objectForKey:@"JKYUYUEGUAHAOCITYDIC"]) {
                        JKChooseAreaViewController* choose = [[[JKChooseAreaViewController alloc] init] autorelease];
                        choose.hidesBottomBarWhenPushed = YES;
                        [self.navigationController pushViewController:choose animated:NO];
                        
                        JKOrderDoctorViewController* order = [[[JKOrderDoctorViewController alloc] init] autorelease];
                        [self.navigationController pushViewController:order animated:YES];
                    }else{
                        JKChooseAreaViewController* choose = [[[JKChooseAreaViewController alloc] init] autorelease];
                        choose.hidesBottomBarWhenPushed = YES;
                        [self.navigationController pushViewController:choose animated:YES];
                    }

                }
                    break;
                case 1:///快速问医生
                {
                    if ([[[JKUserUtil currentUser] businessId] length]) {
                        if(![[JKUserUtil currentUser] profileFull]){
                            IndividualInfoViewController *ivc = [[[IndividualInfoViewController alloc] init] autorelease];
                            ivc.hidesBottomBarWhenPushed = YES;
                            ivc.viewController = @"JKQuickAskDoctorIndexViewController";
                            [self.navigationController pushViewController:ivc animated:YES];
                            return;
                        }
                        JKQuickAskDoctorIndexViewController *vc = [[[JKQuickAskDoctorIndexViewController alloc] init] autorelease];
                        vc.hidesBottomBarWhenPushed = YES;
                        [self.navigationController pushViewController:vc animated:YES];

                    } else {
                        JKBusinessInputView *input = [[[JKBusinessInputView alloc] initWithFrame:CGRectMake(0, 0, RECT_WIDTH(self.view), RECT_HEIGHT(self.view))] autorelease];
                        [self.view addSubview:input];
                    }
                }
                    break;
                default:
                    break;
            }
            break;
        case 2:///体检服务
            switch (index) {
                case 0:///体检预约
                {
                    JKHealthCKPreeViewController *vc = [[[JKHealthCKPreeViewController alloc] initWithNibName:nil bundle:nil] autorelease];
                    vc.hidesBottomBarWhenPushed = YES;
                    [self.navigationController pushViewController:vc animated:YES];
                }
                break;
                default:
                    break;
            }
            break;
        case 3:///健康管理
            switch (index) {
                case 0:///计步器
                {
                    if(![[JKUserUtil currentUser] profileFull]){
                        IndividualInfoViewController *ivc = [[[IndividualInfoViewController alloc] init] autorelease];
                        ivc.hidesBottomBarWhenPushed = YES;
                        ivc.viewController = @"JKPedViewController";
                        [self.navigationController pushViewController:ivc animated:YES];
                        return;
                    }
                    JKPedViewController *JKPedVC = [JKPedViewController sharePedController];
                    [self.navigationController pushViewController:JKPedVC animated:YES];
                }
                    break;
                case 1:///健康体测
                {
                    if(![[JKUserUtil currentUser] profileFull]){
                        IndividualInfoViewController *ivc = [[[IndividualInfoViewController alloc] init] autorelease];
                        ivc.hidesBottomBarWhenPushed = YES;
                        ivc.viewController = @"JKSimicalMainViewController";
                        [self.navigationController pushViewController:ivc animated:YES];
                        return;
                    }
                    JKSimicalMainViewController* vc = [[[JKSimicalMainViewController alloc] init] autorelease];
                    vc.hidesBottomBarWhenPushed = YES;
                    [self.navigationController pushViewController:vc animated:YES];
                }
                    break;
                default:
                    break;
            }
            break;
        case 4:///活动中心
            switch (index) {
                case 0:///企业活动
                {

                    
                    if ([[[JKUserUtil currentUser] businessId] length]) {
                        if(![[JKUserUtil currentUser] profileFull]){
                            IndividualInfoViewController *ivc = [[[IndividualInfoViewController alloc] init] autorelease];
                            ivc.hidesBottomBarWhenPushed = YES;
                            ivc.viewController = @"JKHomeActivityViewController";
                            [self.navigationController pushViewController:ivc animated:YES];
                            return;
                        }
                        JKHomeActivityViewController *vc = [[[JKHomeActivityViewController alloc] init] autorelease];
                        vc.hidesBottomBarWhenPushed = YES;
                        [self.navigationController pushViewController:vc animated:YES];
                    } else {
                        JKBusinessInputView *input = [[[JKBusinessInputView alloc] initWithFrame:CGRectMake(0, 0, RECT_WIDTH(self.view), RECT_HEIGHT(self.view))] autorelease];
                        [self.view addSubview:input];
                    }
        
                }
                    break;
                    
                default:
                    break;
            }
            break;
        default:
            break;
    }
}

- (void)tableViewCellExtendAtTag:(int)tag
{
    switch (tag) {
        case 0:
            if (110 == cellHeight) {
                cellHeight = 180;
            }else if (180 == cellHeight){
                cellHeight = 110;
            }
            [_tableView reloadSections:[NSIndexSet indexSetWithIndex:0] withRowAnimation:UITableViewRowAnimationFade];

            break;
        case 1:
            break;
            
        default:
            break;
    }
}

- (void)tablevIewCellSelectedAtIndex:(int)index
{
    if (0 == index) {
        [self serviceBtnClick];
    }
}

- (void)didReceiveMemoryWarning
{
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

/*
#pragma mark - Navigation

// In a storyboard-based application, you will often want to do a little preparation before navigation
- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender
{
    // Get the new view controller using [segue destinationViewController].
    // Pass the selected object to the new view controller.
}
*/

- (void)viewDidAppear:(BOOL)animated
{
    [super viewDidAppear:animated];
    if (_isAutoPushHCPreeview) {
        _isAutoPushHCPreeview = NO;
        JKHealthCKPreeViewController *vc = [[[JKHealthCKPreeViewController alloc] initWithNibName:nil bundle:nil] autorelease];
        [self.navigationController pushViewController:vc animated:YES];
    }
}

- (void)paySuccessNotif:(NSNotification *)notif
{
    [self performSelector:@selector(pushPreeview) withObject:self afterDelay:0.01];
}

- (void)pushPreeview
{
    JKHealthCKPreeViewController *vc = [[[JKHealthCKPreeViewController alloc] initWithNibName:nil bundle:nil] autorelease];
    [self.navigationController pushViewController:vc animated:YES];
}

@end
