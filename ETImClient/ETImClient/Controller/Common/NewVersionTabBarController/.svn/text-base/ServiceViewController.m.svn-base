//
//  ServiceViewController.m
//  HM-HEALTH
//
//  Created by hujiwei on 14/7/16.
//  Copyright (c) 2014年 PingAn. All rights reserved.
//

#import "ServiceViewController.h"
#import "CoverFlowView.h"
#import "JKOrderDoctorViewController.h"
#import "JKPedViewController.h"
#import "JKHomeActivityViewController.h"
#import "PayAutoViewController.h"
#import "JKChooseAreaViewController.h"
#import "IndividualInfoViewController.h"
#import "JKBusinessInputView.h"
#import "FunctionViewController.h"

@interface ServiceViewController ()<CoverFlowViewDelegate>
{
    CoverFlowView *_coverFlowView;
}

@end

@implementation ServiceViewController

- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil
{
    self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];
    if (self) {
        // Custom initialization
        self.title = @"有服务";
        [self.tabBarItem setFinishedSelectedImage:[UIImage
                                                   imageNamed:@"tab_newService_selected.png"]
                      withFinishedUnselectedImage:[UIImage
                                                   imageNamed:@"tab_newService_unselect.png"]];

    }
    return self;
}

- (void)viewDidLoad
{
    [super viewDidLoad];
    // Do any additional setup after loading the view.
    [self removeBgImageView];
    
    [self updateBgWithIndex:2];
    
    if (IsIOS7) {
        [self setEdgesForExtendedLayout:UIRectEdgeNone];
    }

    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^{
        dispatch_async(dispatch_get_main_queue(), ^{
            
            [self creatCoverFlow];

        });
    });
    
    
    self.navigationItem.rightBarButtonItem = [[UIBarButtonItem alloc] initWithTitle:@"更多" style:UIBarButtonItemStylePlain target:self action:@selector(showFun)];
    [self.navigationItem.rightBarButtonItem setTintColor:[UIColor whiteColor]];
}

- (void)showFun
{
    FunctionViewController* funVC = [[FunctionViewController alloc] init];
    funVC.hidesBottomBarWhenPushed = YES;
    [self.navigationController pushViewController:funVC animated:YES];
}

- (void)creatCoverFlow
{
    NSMutableArray *sourceImages = [NSMutableArray arrayWithCapacity:4];
    
    for (int i = 0; i <4 ; i++) {
        UIImage *image = [UIImage imageNamed:[NSString stringWithFormat:@"serviceMenu_item%d.png", i]];
        [sourceImages addObject:image];
    }
    
    _coverFlowView = [CoverFlowView coverFlowViewWithFrame:CGRectMake(-30,
                                                                      self.view.frame.size.height - 206 + 20,
                                                                      320,
                                                                      206)
                                                               andImages:sourceImages
                                                          sideImageCount:3
                                                          sideImageScale:0.8
                                                        middleImageScale:1];
    _coverFlowView.delegate = self;
    [self.view addSubview:_coverFlowView];
}

- (void)updateBgWithIndex:(NSInteger)index
{
    self.functionBGImageView.alpha = 0.7;
    
    [UIView animateWithDuration:.3 animations:^{
        self.functionBGImageView.alpha = 1;
        self.functionBGImageView.image = [UIImage imageNamed:[NSString stringWithFormat:@"serviceView_bg%d.png", index]];
    }];
}

#pragma mark - CoverFlowViewDelegate
- (void)coverFlowView:(CoverFlowView *)overFlowView didSelectItem:(NSInteger)index
{
    NSLog(@">>>>> %d", index);
    switch (index) {
        case 0:
            [self functionJibu];
            break;
        case 1:
            [self functionHuodong];
            break;
        case 2:
            [self functionGuahao];
            break;
        case 3:
            [self functionLipei];
            break;
        default:
            break;
    }
}

- (void)functionJibu
{
    if (![[JKUserUtil currentUser] profileFull]) {
        IndividualInfoViewController *vc = [[IndividualInfoViewController alloc] init];
        vc.hidesBottomBarWhenPushed = YES;
        vc.viewController = @"JKPedViewController";
        [self.navigationController pushViewController:vc animated:YES];
        return;
    }
    JKPedViewController *JKPedVC = [JKPedViewController sharePedController];
    JKPedVC.hidesBottomBarWhenPushed = YES;
    [self.navigationController pushViewController:JKPedVC animated:YES];
}

- (void)functionHuodong
{
    if ([[[JKUserUtil currentUser] businessId] length]) {
        if (![[JKUserUtil currentUser] profileFull]) {
            IndividualInfoViewController *vc = [[IndividualInfoViewController alloc] init];
            vc.hidesBottomBarWhenPushed = YES;
            vc.viewController = @"JKHomeActivityViewController";
            [self.navigationController pushViewController:vc animated:YES];
            return;
        }
        JKHomeActivityViewController *vc = [[JKHomeActivityViewController alloc] init];
        vc.hidesBottomBarWhenPushed = YES;
        [self.navigationController pushViewController:vc animated:YES];
    } else {
        JKBusinessInputView *input = [[JKBusinessInputView alloc] initWithFrame:CGRectMake(0, 0, RECT_WIDTH(self.view), RECT_HEIGHT(self.view))];
        [self.view addSubview:input];
    }
}

- (void)functionGuahao
{
    if (![[JKUserUtil currentUser] profileFull]) {
        IndividualInfoViewController *vc = [[IndividualInfoViewController alloc] init];
        vc.hidesBottomBarWhenPushed = YES;
        vc.viewController = @"JKChooseAreaViewController";
        [self.navigationController pushViewController:vc animated:YES];
        return;
    }
    
    if ([[NSUserDefaults standardUserDefaults] objectForKey:@"JKYUYUEGUAHAOCITYDIC"]) {
        JKChooseAreaViewController* choose = [[JKChooseAreaViewController alloc] init];
        choose.hidesBottomBarWhenPushed = YES;
        [self.navigationController pushViewController:choose animated:NO];
        
        JKOrderDoctorViewController* order = [[JKOrderDoctorViewController alloc] init];
        [self.navigationController pushViewController:order animated:YES];
    }else{
        JKChooseAreaViewController* choose = [[JKChooseAreaViewController alloc] init];
        choose.hidesBottomBarWhenPushed = YES;
        [self.navigationController pushViewController:choose animated:YES];
    }


}

- (void)functionLipei
{
    PayAutoViewController *payAutoVC = [[PayAutoViewController alloc] init];
    payAutoVC.hidesBottomBarWhenPushed = YES;
    [self.navigationController pushViewController:payAutoVC animated:YES];
}

- (void)coverFlowView:(CoverFlowView *)overFlowView middleItem:(NSInteger)index
{
    [self updateBgWithIndex:index];
}

- (void)didReceiveMemoryWarning
{
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

- (void)dealloc {
    _coverFlowView.delegate = nil;
}

@end
